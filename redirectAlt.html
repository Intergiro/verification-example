<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title></title>
</head>

<body style="height:90vh; width:90vw; margin:auto;">
	<iframe name="verification" id="verification"
		style="position:relative; z-index:2; width:100%; height:100%; border:none; box-sizing: border-box;"></iframe>
	<form method="post" id="iframePost" action="https://merchant.intergiro.com/v1/authorization/redirect"
		target="verification">
		<input type="hidden" id="input" name="input"></input>
		<input type="hidden" id="key" name="key"></input>
	</form>
</body>
<script>
	let search = (new URL(document.location)).searchParams;
	let pan = search.get('automatic') ? "9001100911111111" : "4111111111111111"; 
	const expiryYear = (new Date(Date.now()).getFullYear() - 2000 + 1)
	const input = {
		"number": "Number",
		"items": 250,
		"currency": "EUR",
		"card": {
			"pan": pan,
			"expires": [
				2,
				expiryYear
			],
			"csc": "987"
		},
		"browser": { "parent": window.location.origin }
	}
	const key = search.get('key') ? `Bearer ${search.get('key')}` : "Bearer <insert public api-key here>";
	const form = document.getElementById("iframePost")
	form.input.value = JSON.stringify(input)
	form.key.value = key
	form.submit()

	window.addEventListener("message", async e => {
		if (e.data.destination == "parent" && e.data.content.name == "authorization") {
			appendTobody("h1", "Created Authorization:")
			appendTobody("p", e.data.content.value)
			alert(e.data.content.value)
		}
	})

	function appendTobody(elementType, text) {
		const element = document.createElement(elementType)
    element.textContent = text
  	document.body.appendChild(element)
	}

</script>

</html>