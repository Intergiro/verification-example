<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title></title>
	<script type="text/javascript" src="./utilities.js"></script>
</head>
<style>
	iframe {
		border: none;
		height: 70vh;
		width: 90vw;
		max-width: 40em;
	}

	input {
		display: block;
	}
</style>

<script>
	let authorization
	window.addEventListener('DOMContentLoaded', (event) => {
		initialize()
	});
	function submit() {
		authorization = {
			"number": generateUnique(), // "Should be your unique authorization number"
			"items": Number(document.getElementById("amount").value),
			"currency": "EUR",
			"card": {
				"pan": document.getElementById("pan").value,
				"expires": [
					Number(document.getElementById("expires").value.split("/")[0]),
					Number(document.getElementById("expires").value.split("/")[1])
				],
				"csc": document.getElementById("csc").value
			},
			target: "https://webhook.site/13d03d82-cb27-4d4a-bcb8-f9377e4df40b"
			// browser: { parent: window.location.origin }
		}
		authorize()
	}
	async function authorize() {
		const form = document.getElementById("iframePost")
		form.input.value = JSON.stringify(authorization)
		form.key.value = "Bearer " + document.getElementById("api-key").value.trim()
		form.submit()
	}
	window.addEventListener("message", async e => {
		if (e.data.destination == "parent" && e.data.content.name == "authorization") {
			alert(e.data.content.value)
			appendTobody("h1", "Created Authorization:")
			appendTobody("p", e.data.content.value)
		}
	})
</script>

<body style="width: 100%; max-width: 20em; margin-left: auto; margin-right: auto;">
	<form method="post" id="iframePost" action="https://merchant.intergiro.com/v1/authorization/redirect"
		target="verification">
		<input type="hidden" id="input" name="input"></input>
		<input type="hidden" id="key" name="key"></input>
	</form>
	<form method="post">
		<label for="key">Public API key</label>
		<input type="text" id="api-key" name="key" value="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJodHRwczovL2FwaS5wYXlmdW5jLmNvbSIsImlhdCI6MTY0ODU1Njc2MSwibmFtZSI6IlRyb2NhZGVybyBUZWFtIFRlc3QgTWVyY2hhbnQiLCJhZ2VudCI6IlBheUZ1bmMiLCJ0eXBlIjoidGVzdCIsInVybCI6Ind3dy5leGFtcGxlLmNvbSIsImNhcmQiOnsiYWNxdWlyZXIiOiJIMW1YR2dGa2p1alNJd1ctaEIwblhGT1A3TTBGUkxYUTdHa09nUHNTMlYtOW1DaWRBNE9XRE1BbUJQYW44eGVmX2VVaHc2QUV2dDg1TTN1U2Z4Q0NCQ0p3Y205MGIyTnZiQ0k2SW1sdWRHVnlaMmx5YnlJc0luVnliQ0k2SW1oMGRIQnpPaTh2WVhCcExuQmhlV1oxYm1NdVkyOXRJbjAiLCJjb3VudHJ5IjoiU0UiLCJkZXNjcmlwdG9yIjoidGVzdCB0cmFuc2FjdGlvbiIsImVtdjNkIjoiYS01S1VYUmxTUEZWR09nME5uREtEcDdDMXVSRHV0ampTMHlJYnVMRnRQcXBpa19rTkRsZlg3TGwxcnlQdl9rQjZyaGtadGZpTE8zNHRyNUFCWWZIZUNJc0luVnliQ0k2SW1oMGRIQnpPaTh2YzJWeWRtbGpaUzV6WVc1a1ltOTRMak5rYzJWamRYSmxMbWx2SW4wc2V5SndjbTkwYjJOdmJDSTZJbU5vTTJReElpd2lkWEpzSWpvaWFIUjBjSE02THk5aGNHa3VZMkZ5WkdaMWJtTXVZMjl0TDJOb00yUXhjMmx0SWl3aWEyVjVJam9pYm04dGEyVjVJbjFkIiwibWNjIjoiMTIzNCIsIm1pZCI6IjgxMDMwMDAxMTEiLCJ1cmwiOiJodHRwczovL2FwaS5wYXlmdW5jLmNvbSJ9LCJzdWIiOiJVRmE5enRXMSIsImF1ZCI6InB1YmxpYyIsImZlYXR1cmVzIjoiIn0.pLBXNL6Uj2OEYdbk1o5m2KYaLyWBcSAnhhFdmrZ5vrA" />
		<label for="pan">PAN</label>
		<input type="text" id="pan" name="pan" value="4111111111111111" />
		<label for="csc">CSC</label>
		<input type="text" id="csc" name="csc" value="987" />
		<label for="expires">Expires</label>
		<input type="text" id="expires" name="expires" placeholder="MM/YY" value="1/32" />
		<label for="amount">Amount</label>
		<input type="text" id="amount" name="amount" value="250" />
	</form>
	<button onclick="submit()">Submit</button>
	<iframe id="verification" name="verification"></iframe>
</body>

</html>
